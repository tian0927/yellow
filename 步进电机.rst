开发板控制步进电机
=================================
工具/原料
------------------

* Trailbreaker开发板一个
* 步进电机模块一个
* USB数据线一条
* RJ48接口线一条
* PuTTY串口连接软件

方法/步骤
------------------
1.步进电机工作原理。
^^^^^^^^^^^^^^^^^^^^^
步进电动机用电脉冲信号进行控制，当步进电动机驱动器接收到一个脉冲信号，它就驱动步进电机按设定的方向转动一个固定的角度，当连续不断的给电机发送控制脉冲时，电机就会不停的转动。
每一个脉冲信号对应步进电机的某一相或两相绕组的通电状态改变一次，对应转子就转过一定的角度（步距角），当通电状态的改变完成一个循环时，转子就转过一个齿距。

2.28BYJ-48步进电机。
^^^^^^^^^^^^^^^^^^^^^
步进电机模块搭载是28BYJ-48步进电机，它是一个四相八拍电机，电压采用DC5V~12V，其实物图和内部结构示意图如下图所示：

.. image:: https://github.com/tian0927/hello-world/raw/master/bj1.png

28BYJ-48里圈有6个齿，分别标注为0～5，这个叫做转子，转子上的每个齿都是一块永磁体；外圈是定子，跟电机外壳固定在一起，保持不动，上面有8个齿，每个齿上都缠上了一个线圈绕组，正对着的2个齿上的绕组串联在一起，这就形成了四相。
因此，28BYJ-48可以在不同的通电方式下运行，常见的通电方式有：

            四拍（单相绕组通电）：A-B-C-D-A…

            双四拍（双相绕组通电）：AB-BC-CD-DA-AB...

            八拍： A-AB-B-BC-C-CD-D-DA-A…

3.硬件连接。
^^^^^^^^^^^^^^^^^^^^^
先用RJ48接口线将Trailbreaker开发板和步进电机模块连接起来，然后用USB数据线将Trailbreaker连接到电脑，连接方法如下图所示：

.. image:: https://github.com/tian0927/hello-world/raw/master/bj2.png

此时电脑出现PYBFLASH盘符，盘中有“boot.py”、“main.py”、“pybcdc.inf”、“README.txt”四个文件：

.. image:: https://github.com/tian0927/hello-world/raw/master/bj3.png

4.打开步进电机模块的电路原理图，查看步进电机和对应RJ48接口的引脚号。
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
从如下步进电机的实物图和原理图可以看到，步进电机的蓝、粉、黄、橙、红线分别接在J3的1、2、3、4、5号引脚。其中5号引脚接在VCC上（即红线接电源），1、2、3、4号引脚分别接在ULN2003AD的输出端上（ULN2003AD是一个7路反向器电路，同时放大电流增强驱动能力）。

.. image:: https://github.com/tian0927/hello-world/raw/master/bj4.png

再从下面模块的RJ48接口原理图可推知，步进电机的粉、黄、橙、红线最终相当于接在J2的2、4、9、10号引脚上。

.. image:: https://github.com/tian0927/hello-world/raw/master/bj5.png

5.打开Trailbreaker开发板的电路原理图，查找与步进电机对应的引脚号。
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
从Trailbreaker的RJ48接口原理图（我们用的是J11接口）和RJ48接口线两端的对应规则可知，步进电机J2的2、4、9、10号分别引脚对应Trailbreaker的4、2、9、10号引脚，即PA1-X2、PA0-X1、PA2-X3、PA3-X4。

.. image:: https://github.com/tian0927/hello-world/raw/master/bj6.png

因此，从以上的分析我们最终可以得出以下对应关系：

                    红色线  -> VCC

                    橙色线  -> X2

                    黄色线  -> X1

                    粉色线  -> X3

                    蓝色线  -> X4

6.在知道了步进电机原理和引脚对应关系后，我们就可以开始编写代码了。
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
使用Notepad++打开PYBFLASH盘中的“main.py”文件，在该文件中写入以下代码，以控制步进电机齿轮转动180度。

.. image:: https://github.com/tian0927/hello-world/raw/master/bj7.png

.. image:: https://github.com/tian0927/hello-world/raw/master/bj8.png

.. image:: https://github.com/tian0927/hello-world/raw/master/bj9.png


7.复位开发板，运行代码。
^^^^^^^^^^^^^^^^^^^^^^^^^^
在给步进电机模块上电后（将其堆叠到Trailbreaker开发板上或和Trailbreaker一起放到底板上），复位Trailbreaker开发板（直接按开发板上的RST键），就可以看到步进电机齿轮刚好转过了180度。

.. image:: https://github.com/tian0927/hello-world/raw/master/bj10.png

8.拓展练习。
^^^^^^^^^^^^^^^^^^^^^
将代码SteperRun(180)中的180改成任意数值，可控制步进电机齿轮转过相应的角度；
可以改变驱动节拍的顺序，实现步进电机反向转动；
可以改变每拍的延迟时间，控制步进电机的转速；
还可以通过单四拍或八拍的方式驱动步进电机转动。
根据上面所讲的原理，这些都很容易实现，请大家自己动手尝试         